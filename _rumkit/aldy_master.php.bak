<?php
error_reporting(E_ALL ^E_NOTICE ^E_DEPRECATED); 
ini_set('display_errors',0);
include "aldy_koneksi.php";
$conn = mysqli_connect($servername, $username, $password, $database);
$menu=$_GET[menu];
$act=$_GET[act];

//compress image
			function compressedImage($source, $path, $quality) {

            $info = getimagesize($source);

            if ($info['mime'] == 'image/jpeg') 
                $image = imagecreatefromjpeg($source);

            elseif ($info['mime'] == 'image/gif') 
                $image = imagecreatefromgif($source);

            elseif ($info['mime'] == 'image/png') 
                $image = imagecreatefrompng($source);

            imagejpeg($image, $path, $quality);

			}

//aldy_user
if ($menu=='aldy_user' and $act=='tambah')
{
	   $filename = $_FILES['foto_user']['name'];
	   $ukuran=$_FILES['foto_user']['size'];
       $valid_ext = array('png','jpeg','jpg');
  	   $photoExt1 = @end(explode('.', $filename)); // explode the image name to get the extension
	   $phototest1 = strtolower($photoExt1);
	 	  
	   $new_profle_pic ="foto_user". time().'.'.$phototest1;
 
       // Location
       $location = "foto_user/".$new_profle_pic;
       
	   // file extension
       $file_extension = pathinfo($location, PATHINFO_EXTENSION);
       $file_extension = strtolower($file_extension);
       if(in_array($file_extension,$valid_ext))
		{  
		   compressedImage($_FILES['foto_user']['tmp_name'],$location,10);
		}
	    else
        {
              echo "<center><br><br><br>Foto Salah";
		      exit;
        }
   $enpass=md5($_POST[aldy_password]);
   mysqli_query($conn,"insert into aldy_user(aldy_user_login,aldy_password,aldy_nama,aldy_level,aldy_foto)
   values('$_POST[aldy_user_login]','$enpass','$_POST[aldy_nama]','$_POST[aldy_level]','$new_profle_pic')");
   header('location:index.php?menu=aldy_user');
}
else if ($menu=='aldy_user' and $act=='edit')
{
	$filename = $_FILES['foto_user']['name'];
	   $ukuran=$_FILES['foto_user']['size'];
       $valid_ext = array('png','jpeg','jpg');
  	   $photoExt1 = @end(explode('.', $filename)); // explode the image name to get the extension
	   $phototest1 = strtolower($photoExt1);
	 	  
	   $new_profle_pic ="foto_user". time().'.'.$phototest1;
 
       // Location
       if (!empty($filename))
	   {
	       $location = "foto_user/".$new_profle_pic;
       	   // file extension
           $file_extension = pathinfo($location, PATHINFO_EXTENSION);
           $file_extension = strtolower($file_extension);
           if(in_array($file_extension,$valid_ext))
		   {  
		      compressedImage($_FILES['foto_user']['tmp_name'],$location,10);
		   }
	       else
           { 
                echo "<center><br><br><br>Foto Salah";
		        exit;
           }
		   $enpass=md5($_POST[aldy_password]);
			mysqli_query($conn,"update aldy_user set aldy_user_login='$_POST[aldy_user_login]',
												     aldy_password  ='$enpass',
													 aldy_nama      ='$_POST[aldy_nama]',
													 aldy_level     ='$_POST[aldy_level]',
													 aldy_foto      ='$new_profle_pic'
													 where aldy_id_user='$_POST[aldy_id_user]'");
			   
		}
		else
		{

			$enpass=md5($_POST[aldy_password]);
			mysqli_query($conn,"update aldy_user set aldy_user_login='$_POST[aldy_user_login]',
												     aldy_password  ='$enpass',
													 aldy_nama      ='$_POST[aldy_nama]',
													 aldy_level     ='$_POST[aldy_level]'
													 where aldy_id_user='$_POST[aldy_id_user]'");
		 }
			header('location:index.php?menu=aldy_user');
}
else if ($menu=='aldy_user' and $act=='hapus')
{
	mysqli_query($conn, "delete from aldy_user where aldy_id_user='$_POST[aldy_id_user]'");
	header('location:index.php?menu=aldy_user');
}

//aldy_pelanggan
if ($menu=='aldy_pelanggan' and $act=='tambah')
{
	   $filename = $_FILES['foto_pelanggan']['name'];
	   $ukuran=$_FILES['foto_pelanggan']['size'];
       $valid_ext = array('png','jpeg','jpg');
  	   $photoExt1 = @end(explode('.', $filename)); // explode the image name to get the extension
	   $phototest1 = strtolower($photoExt1);
	 	  
	   $new_profle_pic ="foto_pelanggan". time().'.'.$phototest1;
 
       // Location
       $location = "foto_pelanggan/".$new_profle_pic;
       
	   // file extension
       $file_extension = pathinfo($location, PATHINFO_EXTENSION);
       $file_extension = strtolower($file_extension);
       if(in_array($file_extension,$valid_ext))
		{  
		   compressedImage($_FILES['foto_pelanggan']['tmp_name'],$location,10);
		}
	    else
        {
              echo "<center><br><br><br>Foto Salah";
		      exit;
        }
   mysqli_query($conn,"insert into aldy_pelanggan(aldy_no_ktp,aldy_nama,aldy_alamat,aldy_no_hp,aldy_foto)
   values('$_POST[aldy_no_ktp]','$_POST[aldy_nama]','$_POST[aldy_alamat]','$_POST[aldy_no_hp]','$new_profle_pic')");
   header('location:index.php?menu=aldy_pelanggan');
}
else if ($menu=='aldy_pelanggan' and $act=='edit')
{
    $filename = $_FILES['foto_pelanggan']['name'];
	   $ukuran=$_FILES['foto_pelanggan']['size'];
       $valid_ext = array('png','jpeg','jpg');
  	   $photoExt1 = @end(explode('.', $filename)); // explode the image name to get the extension
	   $phototest1 = strtolower($photoExt1);
	 	  
	   $new_profle_pic ="foto_pelanggan". time().'.'.$phototest1;
 
       // Location
       if (!empty($filename))
	   {
	       $location = "foto_pelanggan/".$new_profle_pic;
       	   // file extension
           $file_extension = pathinfo($location, PATHINFO_EXTENSION);
           $file_extension = strtolower($file_extension);
           if(in_array($file_extension,$valid_ext))
		   {  
		      compressedImage($_FILES['foto_pelanggan']['tmp_name'],$location,10);
		   }
	       else
           { 
                echo "<center><br><br><br>Foto Salah";
		        exit;
           }
			$ori=$_POST['aldy_no_ktp_ori'];
			$changed=$_POST['aldy_no_ktp'];
			mysqli_query($conn,"update aldy_pelanggan set aldy_no_ktp      ='$changed',
														  aldy_nama		   ='$_POST[aldy_nama]',
														  aldy_alamat      ='$_POST[aldy_alamat]',
														  aldy_no_hp       ='$_POST[aldy_no_hp]',
														  aldy_foto        ='$new_profle_pic'
														  where aldy_no_ktp='$ori'");
	   }
	   else
	   {
		    $ori=$_POST['aldy_no_ktp_ori'];
			$changed=$_POST['aldy_no_ktp'];
			mysqli_query($conn,"update aldy_pelanggan set aldy_no_ktp	  ='$changed',
														  aldy_nama	      ='$_POST[aldy_nama]',
														  aldy_alamat     ='$_POST[aldy_alamat]',
														  aldy_no_hp      ='$_POST[aldy_no_hp]'
														  where aldy_no_ktp='$ori'");
	   }
	header('location:index.php?menu=aldy_pelanggan');
}
else if ($menu=='aldy_pelanggan' and $act=='hapus')
{
	mysqli_query($conn, "delete from aldy_pelanggan where aldy_no_ktp='$_POST[aldy_no_ktp]'");
	header('location:index.php?menu=aldy_pelanggan');
}

//aldy_destinasi
if ($menu=='aldy_destinasi' and $act=='tambah')
{
	   $filename = $_FILES['foto_destinasi']['name'];
	   $ukuran=$_FILES['foto_destinasi']['size'];
       $valid_ext = array('png','jpeg','jpg');
  	   $photoExt1 = @end(explode('.', $filename)); // explode the image name to get the extension
	   $phototest1 = strtolower($photoExt1);
	 	  
	   $new_profle_pic ="foto_destinasi". time().'.'.$phototest1;
 
       // Location
       $location = "foto_destinasi/".$new_profle_pic;
       
	   // file extension
       $file_extension = pathinfo($location, PATHINFO_EXTENSION);
       $file_extension = strtolower($file_extension);
       if(in_array($file_extension,$valid_ext))
		{  
		   compressedImage($_FILES['foto_destinasi']['tmp_name'],$location,10);
		}
	    else
        {
              echo "<center><br><br><br>Foto Salah";
		      exit;
        }
   
   mysqli_query($conn,"insert into aldy_destinasi(aldy_kd_destinasi,aldy_tujuan,aldy_harga,aldy_hari,aldy_foto)
   values('$_POST[aldy_kd_destinasi]','$_POST[aldy_tujuan]','$_POST[aldy_harga]','$_POST[aldy_hari]','$new_profle_pic')");
   header('location:index.php?menu=aldy_destinasi');
}
else if ($menu=='aldy_destinasi' and $act=='edit')
{
	$filename = $_FILES['foto_destinasi']['name'];
	   $ukuran=$_FILES['foto_destinasi']['size'];
       $valid_ext = array('png','jpeg','jpg');
  	   $photoExt1 = @end(explode('.', $filename)); // explode the image name to get the extension
	   $phototest1 = strtolower($photoExt1);
	 	  
	   $new_profle_pic ="foto_destinasi". time().'.'.$phototest1;
 
       // Location
       if (!empty($filename))
	   {
	       $location = "foto_destinasi/".$new_profle_pic;
       	   // file extension
           $file_extension = pathinfo($location, PATHINFO_EXTENSION);
           $file_extension = strtolower($file_extension);
           if(in_array($file_extension,$valid_ext))
		   {  
		      compressedImage($_FILES['foto_destinasi']['tmp_name'],$location,10);
		   }
	       else
           { 
                echo "<center><br><br><br>Foto Salah";
		        exit;
           }
		    $ori=$_POST['aldy_kd_destinasi_ori'];
			$changed=$_POST['aldy_kd_destinasi'];
			mysqli_query($conn,"update aldy_destinasi set aldy_kd_destinasi	 ='$changed',
												          aldy_tujuan		 ='$_POST[aldy_tujuan]',
														  aldy_harga		 ='$_POST[aldy_harga]',
														  aldy_hari			 ='$_POST[aldy_hari]',
														  aldy_foto			 ='$new_profle_pic'
													 where aldy_kd_destinasi='$ori'");
			   
		}
		else
		{
			$ori=$_POST['aldy_kd_destinasi_ori'];
			$changed=$_POST['aldy_kd_destinasi'];
			mysqli_query($conn,"update aldy_destinasi set aldy_kd_destinasi	 ='$changed',
												          aldy_tujuan		 ='$_POST[aldy_tujuan]',
														  aldy_harga		 ='$_POST[aldy_harga]',
														  aldy_hari			 ='$_POST[aldy_hari]'
														
													 where aldy_kd_destinasi='$ori'");
		 }
			header('location:index.php?menu=aldy_destinasi');
}
else if ($menu=='aldy_destinasi' and $act=='hapus')
{
	mysqli_query($conn, "delete from aldy_destinasi where aldy_kd_destinasi='$_POST[aldy_kd_destinasi]'");
	header('location:index.php?menu=aldy_destinasi');
}

//aldy_makanan
if ($menu=='aldy_makanan' and $act=='tambah')
{
	   $filename = $_FILES['foto_makanan']['name'];
	   $ukuran=$_FILES['foto_makanan']['size'];
       $valid_ext = array('png','jpeg','jpg');
  	   $photoExt1 = @end(explode('.', $filename)); // explode the image name to get the extension
	   $phototest1 = strtolower($photoExt1);
	 	  
	   $new_profle_pic ="foto_makanan". time().'.'.$phototest1;
 
       // Location
       $location = "foto_makanan/".$new_profle_pic;
       
	   // file extension
       $file_extension = pathinfo($location, PATHINFO_EXTENSION);
       $file_extension = strtolower($file_extension);
       if(in_array($file_extension,$valid_ext))
		{  
		   compressedImage($_FILES['foto_makanan']['tmp_name'],$location,10);
		}
	    else
        {
              echo "<center><br><br><br>Foto Salah";
		      exit;
        }
   mysqli_query($conn,"insert into aldy_makanan(aldy_paket,aldy_harga,aldy_foto)
   values('$_POST[aldy_paket]','$_POST[aldy_harga]','$new_profle_pic')");
   header('location:index.php?menu=aldy_makanan');
}
else if ($menu=='aldy_makanan' and $act=='edit')
{
	   $filename = $_FILES['foto_makanan']['name'];
	   $ukuran=$_FILES['foto_makanan']['size'];
       $valid_ext = array('png','jpeg','jpg');
  	   $photoExt1 = @end(explode('.', $filename)); // explode the image name to get the extension
	   $phototest1 = strtolower($photoExt1);
	 	  
	   $new_profle_pic ="foto_makanan". time().'.'.$phototest1;
 
       // Location
       if (!empty($filename))
	   {
	       $location = "foto_makanan/".$new_profle_pic;
       	   // file extension
           $file_extension = pathinfo($location, PATHINFO_EXTENSION);
           $file_extension = strtolower($file_extension);
           if(in_array($file_extension,$valid_ext))
		   {  
		      compressedImage($_FILES['foto_makanan']['tmp_name'],$location,10);
		   }
	       else
           { 
                echo "<center><br><br><br>Foto Salah";
		        exit;
           }
			mysqli_query($conn,"update aldy_makanan set   aldy_paket	  ='$_POST[aldy_paket]',
													   aldy_harga	  ='$_POST[aldy_harga]',
													   aldy_foto      ='$new_profle_pic'
													   where aldy_id_makanan='$_POST[aldy_id_makanan]'");
	   }
	   else
	   {
		   mysqli_query($conn,"update aldy_makanan set aldy_paket	  ='$_POST[aldy_paket]',
													   aldy_harga	  ='$_POST[aldy_harga]'
													   where aldy_id_makanan='$_POST[aldy_id_makanan]'");
	   }
	header('location:index.php?menu=aldy_makanan');
}
else if ($menu=='aldy_makanan' and $act=='hapus')
{
	mysqli_query($conn, "delete from aldy_makanan where aldy_id_makanan='$_POST[aldy_id_makanan]'");
	header('location:index.php?menu=aldy_makanan');
}

//aldy_hotel
if ($menu=='aldy_hotel' and $act=='tambah')
{
   mysqli_query($conn,"insert into aldy_hotel(aldy_nm_hotel,aldy_kelas,aldy_harga)
   values('$_POST[aldy_nm_hotel]','$_POST[aldy_kelas]','$_POST[aldy_harga]')");
   header('location:index.php?menu=aldy_hotel');
}
else if ($menu=='aldy_hotel' and $act=='edit')
{
   	mysqli_query($conn,"update aldy_hotel set  aldy_nm_hotel  ='$_POST[aldy_nm_hotel]',
											   aldy_kelas	  ='$_POST[aldy_kelas]',
											   aldy_harga     ='$_POST[aldy_harga]'
											   where aldy_id_hotel='$_POST[aldy_id_hotel]'");
	header('location:index.php?menu=aldy_hotel');
}
else if ($menu=='aldy_hotel' and $act=='hapus')
{
	mysqli_query($conn, "delete from aldy_hotel where aldy_id_hotel='$_POST[aldy_id_hotel]'");
	header('location:index.php?menu=aldy_hotel');
}

?>